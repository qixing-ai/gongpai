# å·¥ç‰ŒOBJæ¨¡å‹é‡æ‹“æ‰‘ä¼˜åŒ–è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°å¯¹å·¥ç‰ŒOBJå¯¼å‡ºå™¨è¿›è¡Œäº†é‡æ‹“æ‰‘ä¼˜åŒ–ï¼Œä¸»è¦é’ˆå¯¹æ­£é¢å’ŒèƒŒé¢çš„UVæ˜ å°„éƒ¨åˆ†è¿›è¡Œé‡æ„ï¼Œä»åŸæ¥ç®€å•çš„è¾å°„ä¸‰è§’é¢æ”¹ä¸ºå¯†é›†çš„æ­£æ–¹å½¢ç½‘æ ¼åˆ’åˆ†ï¼Œä¸“é—¨ä¸ºåç»­çš„é¡¶ç‚¹é¢œè‰²æ˜ å°„æ“ä½œè¿›è¡Œä¼˜åŒ–ã€‚

## ä¸»è¦æ”¹è¿›

### 1. é‡æ‹“æ‰‘ç®—æ³• (`enableRetopology`)
- **æ–°å¢åŠŸèƒ½**ï¼šæ™ºèƒ½é‡æ‹“æ‰‘ç³»ç»Ÿï¼Œå¯åŠ¨æ€è°ƒæ•´ç½‘æ ¼å¯†åº¦
- **é»˜è®¤çŠ¶æ€**ï¼šå¯ç”¨ï¼ˆ`enableRetopology: true`ï¼‰
- **å¯†åº¦ç­‰çº§**ï¼š
  - `low`: 20x20 ç½‘æ ¼
  - `medium`: 40x40 ç½‘æ ¼  
  - `high`: 60x60 ç½‘æ ¼ï¼ˆé»˜è®¤ï¼‰
  - `ultra`: 80x80 ç½‘æ ¼

### 2. ä¼˜åŒ–çš„ä¸‰è§’é¢ç”Ÿæˆç®—æ³•
- **å››è¾¹å½¢åˆ†å‰²ç­–ç•¥**ï¼šä½¿ç”¨å¯¹è§’çº¿é•¿åº¦æ¯”è¾ƒï¼Œé€‰æ‹©æœ€ä¼˜åˆ†å‰²æ–¹å‘
- **é«˜è´¨é‡ä¸‰è§’å½¢**ï¼šç¡®ä¿ä¸‰è§’å½¢è´¨é‡ï¼Œé¿å…é€€åŒ–ä¸‰è§’å½¢
- **æ³•çº¿æ­£ç¡®æ€§**ï¼šæ­£é¢å’ŒèƒŒé¢æ³•çº¿æ–¹å‘æ­£ç¡®ï¼Œæ”¯æŒåŒé¢å’Œå•é¢æ¨¡å‹

### 3. ç½‘æ ¼å¯†åº¦é…ç½®
```javascript
// é»˜è®¤é…ç½®ï¼ˆé«˜å¯†åº¦é‡æ‹“æ‰‘ï¼‰
exportSettings = {
  doubleSided: true,
  thickness: 2.0,
  meshDensity: { width: 40, height: 40 },
  meshQuality: {
    enableBoundaryConnection: true,
    maxBoundaryConnections: 3,
    enableRetopology: true,          // å¯ç”¨é‡æ‹“æ‰‘
    retopologyDensity: 'high'        // é«˜å¯†åº¦ç½‘æ ¼
  }
}
```

### 4. è¾¹ç•Œè¿æ¥ä¼˜åŒ–
- **é‡æ‹“æ‰‘ä¸“ç”¨è¿æ¥**ï¼š`createRetopologyBoundaryConnection()`
- **æ™ºèƒ½é¡¶ç‚¹åŒ¹é…**ï¼šè‡ªåŠ¨å¯»æ‰¾æœ€è¿‘çš„ç½‘æ ¼é¡¶ç‚¹è¿›è¡Œè¿æ¥
- **æ³•çº¿æ–¹å‘ä¼˜åŒ–**ï¼šæ ¹æ®è¾¹ç•Œç±»å‹ï¼ˆå¤–è¾¹ç•Œ/å­”æ´ï¼‰è‡ªåŠ¨è°ƒæ•´æ³•çº¿æ–¹å‘
- **è§’è½ç¼ºå£ä¿®å¤**ï¼šä¸“é—¨ä¿®å¤å·¦ä¸Šè§’å’Œå³ä¸‹è§’çš„å°ä¸‰è§’ç¼ºå£

## æŠ€æœ¯ç»†èŠ‚

### æ ¸å¿ƒå‡½æ•°

1. **`createRetopologyMeshVertices()`**
   - ç”Ÿæˆå¯†é›†çš„é‡æ‹“æ‰‘ç½‘æ ¼é¡¶ç‚¹
   - æ”¯æŒå¸¦å­”æ´å’Œæ— å­”æ´æ¨¡å¼
   - è‡ªåŠ¨å¤„ç†UVåæ ‡æ˜ å°„

2. **`generateRetopologyTriangles()`**
   - ä¼˜åŒ–çš„å››è¾¹å½¢åˆ†å‰²ç®—æ³•
   - æ™ºèƒ½å¯¹è§’çº¿é€‰æ‹©
   - è¾¹ç•Œä¸å®Œæ•´ä¸‰è§’å½¢å¤„ç†

3. **`createRetopologyBoundaryConnection()`**
   - è¾¹ç•Œåˆ°ç½‘æ ¼çš„æ™ºèƒ½è¿æ¥
   - å‡å°‘å‡Œä¹±ä¸‰è§’å½¢
   - æ”¯æŒå¤–è¾¹ç•Œå’Œå­”æ´è¾¹ç•Œ

4. **`fixCornerGaps()`** â­ æ–°å¢
   - ä¸“é—¨ä¿®å¤è§’è½ç¼ºå£çš„ç®—æ³•
   - åŸºäºåŒ…å›´ç›’çš„ç²¾ç¡®è§’è½æ£€æµ‹
   - å¤šä¸‰è§’å½¢ä¿®å¤ç­–ç•¥ç¡®ä¿å®Œå…¨å°é—­

### å…¼å®¹æ€§

- **å‘åå…¼å®¹**ï¼šä¿ç•™åŸå§‹ç®—æ³•ï¼Œå¯é€šè¿‡ `enableRetopology: false` ç¦ç”¨é‡æ‹“æ‰‘
- **æ¸è¿›å¼å‡çº§**ï¼šç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼Œè‡ªåŠ¨ä½¿ç”¨é‡æ‹“æ‰‘ä¼˜åŒ–
- **çµæ´»é…ç½®**ï¼šæ”¯æŒå¤šç§å¯†åº¦ç­‰çº§ï¼Œæ»¡è¶³ä¸åŒéœ€æ±‚

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨ï¼ˆè‡ªåŠ¨å¯ç”¨é‡æ‹“æ‰‘ï¼‰
```javascript
const result = await exportBadgeAsOBJ(
  badgeSettings, 
  holeSettings, 
  imageSettings, 
  textSettings
);
```

### è‡ªå®šä¹‰é‡æ‹“æ‰‘å¯†åº¦
```javascript
const result = await exportBadgeAsOBJ(
  badgeSettings, 
  holeSettings, 
  imageSettings, 
  textSettings,
  {
    meshQuality: {
      enableRetopology: true,
      retopologyDensity: 'ultra'  // è¶…é«˜å¯†åº¦
    }
  }
);
```

### ç¦ç”¨é‡æ‹“æ‰‘ï¼ˆä½¿ç”¨ä¼ ç»Ÿç®—æ³•ï¼‰
```javascript
const result = await exportBadgeAsOBJ(
  badgeSettings, 
  holeSettings, 
  imageSettings, 
  textSettings,
  {
    meshQuality: {
      enableRetopology: false
    }
  }
);
```

## æ€§èƒ½å¯¹æ¯”

| å¯†åº¦ç­‰çº§ | ç½‘æ ¼è§„æ ¼ | å¤§è‡´ä¸‰è§’å½¢æ•° | é€‚ç”¨åœºæ™¯ |
|---------|---------|-------------|----------|
| low     | 20x20   | ~800        | é¢„è§ˆã€æµ‹è¯• |
| medium  | 40x40   | ~3200       | ä¸€èˆ¬ç”¨é€” |
| high    | 60x60   | ~7200       | é«˜è´¨é‡éœ€æ±‚ |
| ultra   | 80x80   | ~12800      | æé«˜ç²¾åº¦ |

## è¾“å‡ºç‰¹æ€§

- **æ°´å¯†ç»“æ„**ï¼šç¡®ä¿æ¨¡å‹å®Œå…¨å°é—­ï¼Œæ— æ¼æ´
- **æ­£æ–¹å½¢ç½‘æ ¼**ï¼šä¾¿äºé¡¶ç‚¹é¢œè‰²æ˜ å°„å’Œåç»­å¤„ç†
- **é«˜è´¨é‡ä¸‰è§’é¢**ï¼šä¼˜åŒ–çš„åˆ†å‰²ç®—æ³•ï¼Œé¿å…ç»†é•¿ä¸‰è§’å½¢
- **UVæ˜ å°„ä¼˜åŒ–**ï¼šæ­£é¢å’ŒèƒŒé¢æ­£ç¡®çš„UVåæ ‡ï¼Œæ”¯æŒè´´å›¾æ˜ å°„

## è°ƒè¯•åŠŸèƒ½

```javascript
import { testRetopologyFeatures, testCornerFixFeatures, testNormalFixFeatures, testHoleFixFeatures } from './objExporter.js';

// æµ‹è¯•é‡æ‹“æ‰‘åŠŸèƒ½é…ç½®
const testResult = testRetopologyFeatures();
console.log(testResult);

// æµ‹è¯•è§’è½ä¿®å¤åŠŸèƒ½
const cornerResult = testCornerFixFeatures();
console.log(cornerResult);

// æµ‹è¯•æ³•çº¿ä¿®å¤åŠŸèƒ½
const normalResult = testNormalFixFeatures();
console.log(normalResult);

// æµ‹è¯•å­”æ´ä¿®å¤åŠŸèƒ½
const holeResult = testHoleFixFeatures();
console.log(holeResult);
```

## æ³¨æ„äº‹é¡¹

1. **å†…å­˜ä½¿ç”¨**ï¼šé«˜å¯†åº¦ç½‘æ ¼ä¼šå¢åŠ å†…å­˜ä½¿ç”¨ï¼Œå»ºè®®æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚å¯†åº¦
2. **å¤„ç†æ—¶é—´**ï¼šé‡æ‹“æ‰‘ç®—æ³•æ¯”ä¼ ç»Ÿç®—æ³•ç¨æ…¢ï¼Œä½†è´¨é‡æ›´é«˜
3. **æ–‡ä»¶å¤§å°**ï¼šå¯†é›†ç½‘æ ¼ä¼šå¢åŠ OBJæ–‡ä»¶å¤§å°ï¼Œä½†æä¾›æ›´å¥½çš„åç»­å¤„ç†èƒ½åŠ›

## åº”ç”¨åœºæ™¯

- **é¡¶ç‚¹é¢œè‰²æ˜ å°„**ï¼šå¯†é›†ç½‘æ ¼æä¾›æ›´å¤šé¡¶ç‚¹ï¼Œä¾¿äºç²¾ç¡®é¢œè‰²æ˜ å°„
- **ç»†åˆ†å»ºæ¨¡**ï¼šä¸ºåç»­ç»†åˆ†æ“ä½œæä¾›è‰¯å¥½åŸºç¡€
- **3Dæ‰“å°**ï¼šé«˜è´¨é‡ç½‘æ ¼ç¡®ä¿æ‰“å°æ•ˆæœ
- **åŠ¨ç”»åˆ¶ä½œ**ï¼šè§„æ•´ç½‘æ ¼ä¾¿äºå˜å½¢å’ŒåŠ¨ç”»åˆ¶ä½œ

## è§’è½ä¿®å¤ä¸“é¡¹è¯´æ˜ ğŸ”§

### é—®é¢˜èƒŒæ™¯
åœ¨é«˜å¯†åº¦é‡æ‹“æ‰‘è¿‡ç¨‹ä¸­ï¼Œç”±äºç½‘æ ¼å¯†åº¦å¢åŠ ï¼Œè§’è½åŒºåŸŸï¼ˆç‰¹åˆ«æ˜¯å·¦ä¸Šè§’å’Œå³ä¸‹è§’ï¼‰å®¹æ˜“å‡ºç°å°çš„ä¸‰è§’å½¢ç¼ºå£ï¼Œå½±å“æ¨¡å‹çš„å®Œæ•´æ€§ã€‚

### è§£å†³æ–¹æ¡ˆ
1. **æ™ºèƒ½è§’è½æ£€æµ‹**
   - åŸºäºåŒ…å›´ç›’çš„ç²¾ç¡®å®šä½ç®—æ³•
   - è‡ªåŠ¨è¯†åˆ«å››ä¸ªè§’è½åŒºåŸŸï¼šå·¦ä¸Šã€å³ä¸Šã€å·¦ä¸‹ã€å³ä¸‹
   - é˜ˆå€¼è®¾å®šä¸ºè¾¹ç•Œæ¡†çš„10%ï¼Œç¡®ä¿ç²¾ç¡®å®šä½

2. **å¤šå±‚æ¬¡ä¿®å¤ç­–ç•¥**
   - æœç´¢èŒƒå›´æ‰©å±•åˆ°4ä¸ªæœ€è¿‘ç½‘æ ¼é¡¶ç‚¹
   - åˆ›å»ºå¤šä¸ªä¿®å¤ä¸‰è§’å½¢ç¡®ä¿å®Œå…¨å°é—­
   - é‡å¤é¡¶ç‚¹æ£€æŸ¥é¿å…é€€åŒ–ä¸‰è§’å½¢

3. **è‡ªåŠ¨é›†æˆ**
   - æ— éœ€é¢å¤–é…ç½®ï¼Œè‡ªåŠ¨åœ¨é‡æ‹“æ‰‘è¾¹ç•Œè¿æ¥ä¸­æ‰§è¡Œ
   - å®æ—¶è°ƒè¯•ä¿¡æ¯æ˜¾ç¤ºä¿®å¤è¿›åº¦
   - ä¸ç°æœ‰é‡æ‹“æ‰‘ç®—æ³•å®Œå…¨å…¼å®¹

### ä¿®å¤æ•ˆæœ
- âœ… æ¶ˆé™¤å·¦ä¸Šè§’å’Œå³ä¸‹è§’çš„ä¸‰è§’ç¼ºå£
- âœ… ä¿æŒæ¨¡å‹æ°´å¯†æ€§å’Œå®Œæ•´æ€§
- âœ… ä¸å½±å“å…¶ä»–æ­£å¸¸åŒºåŸŸçš„ç½‘æ ¼è´¨é‡
- âœ… é€‚ç”¨äºæ‰€æœ‰å¯†åº¦ç­‰çº§çš„é‡æ‹“æ‰‘

## æ³•çº¿ä¿®å¤ä¸“é¡¹è¯´æ˜ ğŸ§­

### é—®é¢˜èƒŒæ™¯
åœ¨è§’è½ä¿®å¤å’Œè¾¹ç•Œè¿æ¥è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸‰è§’å½¢çš„é¡¶ç‚¹é¡ºåºä¸æ­£ç¡®ï¼Œä¼šå¯¼è‡´æ³•çº¿æ–¹å‘é”™è¯¯ï¼Œä½¿æ¨¡å‹åœ¨æ—‹è½¬æ—¶å‡ºç°å…‰ç…§å¼‚å¸¸æˆ–é¢ç‰‡æ˜¾ç¤ºé”™ä¹±ã€‚

### è§£å†³æ–¹æ¡ˆ
1. **è‡ªåŠ¨æ³•çº¿è®¡ç®—**
   - ä½¿ç”¨å‰ç§¯è®¡ç®—ä¸‰è§’å½¢çš„æ³•çº¿å‘é‡
   - åŸºäºå³æ‰‹å®šåˆ™ç¡®å®šæ­£ç¡®çš„æ³•çº¿æ–¹å‘
   - å®æ—¶æ£€æŸ¥æ¯ä¸ªä¸‰è§’å½¢çš„æ³•çº¿æœå‘

2. **æ™ºèƒ½é¡¶ç‚¹é¡ºåºä¿®æ­£**
   - æ­£é¢ä¸‰è§’å½¢ï¼šæ³•çº¿æŒ‡å‘+Zæ–¹å‘
   - èƒŒé¢ä¸‰è§’å½¢ï¼šæ³•çº¿æŒ‡å‘-Zæ–¹å‘
   - è‡ªåŠ¨ç¿»è½¬é”™è¯¯çš„é¡¶ç‚¹é¡ºåº

3. **ç»Ÿä¸€åº”ç”¨**
   - `addFaceWithNormalCheck()` å‡½æ•°ç»Ÿä¸€å¤„ç†æ‰€æœ‰é¢ç‰‡
   - è§’è½ä¿®å¤å’Œè¾¹ç•Œè¿æ¥éƒ½ä½¿ç”¨æ³•çº¿æ£€æŸ¥
   - ç¡®ä¿æ•´ä¸ªæ¨¡å‹çš„æ³•çº¿ä¸€è‡´æ€§

### æŠ€æœ¯å®ç°
```javascript
// æ ¸å¿ƒæ³•çº¿æ£€æŸ¥å‡½æ•°
calculateTriangleNormal(v1, v2, v3)  // è®¡ç®—æ³•çº¿å‘é‡
isNormalCorrect(v1, v2, v3, isFront) // æ£€æŸ¥æ³•çº¿æ–¹å‘
addFaceWithNormalCheck()             // æ·»åŠ å¸¦æ³•çº¿æ£€æŸ¥çš„é¢
```

### ä¿®å¤æ•ˆæœ
- âœ… è§£å†³æ¨¡å‹æ—‹è½¬æ—¶çš„å…‰ç…§å¼‚å¸¸
- âœ… æ¶ˆé™¤é¢ç‰‡æ˜¾ç¤ºé”™ä¹±é—®é¢˜
- âœ… ç¡®ä¿æ³•çº¿æ–¹å‘ä¸€è‡´æ€§
- âœ… æå‡æ¨¡å‹çš„æ¸²æŸ“è´¨é‡

## å­”æ´ä¿®å¤ä¸“é¡¹è¯´æ˜ ğŸ•³ï¸

### é—®é¢˜èƒŒæ™¯
å½“å·¥ç‰Œæ·»åŠ æŒ–å­”åŠŸèƒ½æ—¶ï¼Œå­”æ´çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’å®¹æ˜“å‡ºç°ä¸‰è§’å½¢ç¼ºå£ï¼ŒåŒæ—¶å­”æ´å†…éƒ¨å¯èƒ½è¢«é”™è¯¯å¡«å……ç½‘æ ¼ï¼Œå½±å“æ¨¡å‹çš„æ­£ç¡®æ€§ã€‚

### å­”æ´ç‰¹æ®Šå¤„ç†
1. **æ™ºèƒ½è¾¹ç•Œè¯†åˆ«**
   - è‡ªåŠ¨åŒºåˆ†å¤–è¾¹ç•Œå’Œå­”æ´è¾¹ç•Œ
   - å­”æ´ä½¿ç”¨15%çš„è§’è½æ£€æµ‹é˜ˆå€¼ï¼ˆæ¯”å¤–è¾¹ç•Œ10%æ›´å®½æ¾ï¼‰
   - ä¸“é—¨çš„å­”æ´è¾¹ç•Œè¿æ¥ç®—æ³•

2. **å¤–å›´ç½‘æ ¼è¿æ¥**
   - åªè¿æ¥å­”æ´å¤–å›´çš„ç½‘æ ¼é¡¶ç‚¹
   - æ™ºèƒ½è¿‡æ»¤ï¼šè‡ªåŠ¨æ’é™¤å­”æ´å†…éƒ¨çš„ç½‘æ ¼é¡¶ç‚¹
   - é˜²æ­¢å­”æ´è¢«é”™è¯¯å¡«å……

3. **ç‰¹æ®Šæ³•çº¿å¤„ç†**
   - å­”æ´è¾¹ç•Œä½¿ç”¨åå‘é¡¶ç‚¹é¡ºåº
   - ç¡®ä¿å­”æ´å†…è¡¨é¢æ³•çº¿æ­£ç¡®
   - ä¸å¤–è¾¹ç•Œæ³•çº¿æ–¹å‘åè°ƒä¸€è‡´

4. **å¢å¼ºè¿æ¥ç­–ç•¥**
   - å­”æ´ä½¿ç”¨æ›´å¤šè¿æ¥ç‚¹ï¼ˆ3-5ä¸ªï¼‰
   - å¤šå±‚æ¬¡è§’è½ä¿®å¤ç¡®ä¿å®Œå…¨å°é—­
   - ç‰¹æ®Šçš„ä¸‰è§’å½¢ç”Ÿæˆé¡ºåº

### æŠ€æœ¯å®ç°
```javascript
// å­”æ´æ£€æµ‹å’Œè¿‡æ»¤
if (isHole) {
  // åªè¿æ¥å­”æ´å¤–å›´çš„ç½‘æ ¼é¡¶ç‚¹
  nearbyVertices = validMeshVertices
    .filter(mv => !this.isPointInPolygon(mv.x, mv.y, boundaryVertices))
    .sort((a, b) => a.distance - b.distance)
    .slice(0, 5); // ä½¿ç”¨æ›´å¤šè¿æ¥ç‚¹
}

// å­”æ´ç‰¹æ®Šé¡¶ç‚¹é¡ºåº
if (isHole) {
  this.addFaceWithNormalCheck(bv1, bv2, mv1.index, buv1, buv2, muv1, isFront);
} else {
  this.addFaceWithNormalCheck(bv1, mv1.index, bv2, buv1, muv1, buv2, isFront);
}
```

### ä¿®å¤æ•ˆæœ
- âœ… æ¶ˆé™¤å­”æ´å·¦ä¸Šè§’å’Œå³ä¸‹è§’çš„ç¼ºå£
- âœ… é˜²æ­¢å­”æ´å†…éƒ¨è¢«é”™è¯¯å¡«å……
- âœ… ç¡®ä¿å­”æ´è¾¹ç•Œæ³•çº¿æ­£ç¡®
- âœ… ä¿æŒå­”æ´å½¢çŠ¶çš„å®Œæ•´æ€§
- âœ… é€‚ç”¨äºåœ†å½¢ã€æ¤­åœ†å½¢ã€çŸ©å½¢ç­‰å„ç§å­”æ´å½¢çŠ¶ 

# å·¥ç‰Œé‡æ‹“æ‰‘ä¸åœ†å¼§è¾¹ç•Œè¿æ¥ç®—æ³•æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å·¥ç‰ŒOBJå¯¼å‡ºå·¥å…·ä¸­çš„é‡æ‹“æ‰‘ç½‘æ ¼ç”Ÿæˆå’Œåœ†å¼§è¾¹ç•Œè¿æ¥ç®—æ³•ã€‚è¯¥ç®—æ³•è§£å†³äº†åœ†å½¢å­”æ´ã€å·¥ç‰Œåœ†è§’ç­‰åœ†å¼§è¾¹ç•Œä¸è§„åˆ™ç½‘æ ¼è¿æ¥æ—¶çš„ç ´æ´å’Œå¤šè¾¹å½¢åŒ–é—®é¢˜ã€‚

## æ ¸å¿ƒé—®é¢˜

### 1. ä¼ ç»Ÿé—®é¢˜
- **ç ´æ´é—®é¢˜**ï¼šåœ†å¼§è¾¹ç•Œä¸è§„åˆ™ç½‘æ ¼è¿æ¥æ—¶å‡ºç°ç¼ºå£
- **å¤šè¾¹å½¢åŒ–**ï¼šåœ†å½¢å­”æ´è¾¹ç¼˜è¢«æ‹‰ç›´ï¼Œå¤±å»åœ†å½¢ç‰¹å¾
- **æ³•çº¿é”™è¯¯**ï¼šä¸‰è§’å½¢æ³•çº¿æ–¹å‘ä¸æ­£ç¡®ï¼Œå¯¼è‡´å…‰ç…§å¼‚å¸¸

### 2. è§£å†³æ€è·¯
- **è¾¹ç•Œç‚¹é›†æˆ**ï¼šå°†åœ†å¼§è¾¹ç•Œç‚¹ç›´æ¥åŠ å…¥ä¸»é¢ç½‘æ ¼
- **ç»Ÿä¸€è¿æ¥ç®—æ³•**ï¼šå­”æ´å’Œåœ†è§’ä½¿ç”¨ç›¸åŒçš„è¿æ¥ç­–ç•¥
- **è´¨é‡æ§åˆ¶**ï¼šä¸‰è§’å½¢å®½é«˜æ¯”æ£€æŸ¥ï¼Œç¡®ä¿å‡ ä½•ç¨³å®šæ€§

## ç®—æ³•æ¶æ„

### 1. ä¸»è¦å‡½æ•°ç»“æ„

```
generateBadgeOBJ()
â”œâ”€â”€ createRetopologyMeshVertices()     // ç”Ÿæˆé‡æ‹“æ‰‘ç½‘æ ¼é¡¶ç‚¹
â”‚   â”œâ”€â”€ ç”Ÿæˆè§„åˆ™ç½‘æ ¼ç‚¹
â”‚   â””â”€â”€ é›†æˆå­”æ´è¾¹ç•Œç‚¹ â˜…
â”œâ”€â”€ generateRetopologyTriangles()      // ç”Ÿæˆä¸»é¢ä¸‰è§’å½¢
â”œâ”€â”€ generateHoleBoundaryTriangles()    // å­”æ´è¾¹ç•Œè¿æ¥ â˜…
â”‚   â””â”€â”€ generateCircularBoundaryConnections() â˜…
â””â”€â”€ createRetopologyBoundaryConnection() // å¤–è¾¹ç•Œè¿æ¥
```

### 2. æ ¸å¿ƒåˆ›æ–°ç‚¹ â˜…

#### A. è¾¹ç•Œç‚¹é›†æˆç­–ç•¥
```javascript
// å°†å­”æ´è¾¹ç•Œç‚¹æ·»åŠ åˆ°ä¸»é¢ç½‘æ ¼ä¸­
if (holeVertices && holeVertices.length > 0) {
  holeVertices.forEach((vIdx, i) => {
    const vertex = this.vertices[vIdx - 1];
    meshVertices.push({
      index: vIdx,
      x: vertex.x,
      y: vertex.y,
      gridX: null,
      gridY: null,
      u: uvU,
      v: uvV,
      isHoleBoundary: true  // æ ‡è®°ä¸ºå­”æ´è¾¹ç•Œç‚¹
    });
  });
}
```

#### B. ç»Ÿä¸€çš„åœ†å¼§è¾¹ç•Œè¿æ¥ç®—æ³•
```javascript
generateCircularBoundaryConnections(meshVertices, meshUVs, boundaryVertices, regularMeshVertices, isFront, isHole)
```

## è¯¦ç»†ç®—æ³•æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šé‡æ‹“æ‰‘ç½‘æ ¼ç”Ÿæˆ

#### 1.1 è§„åˆ™ç½‘æ ¼ç‚¹ç”Ÿæˆ
```javascript
// ç”Ÿæˆå¯†é›†çš„é‡æ‹“æ‰‘ç½‘æ ¼
for (let j = 0; j <= gridHeight; j++) {
  for (let i = 0; i <= gridWidth; i++) {
    const u = i / gridWidth;
    const v = j / gridHeight;
    const x = (u - 0.5) * width;
    const y = (v - 0.5) * height;
    
    // æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨æœ‰æ•ˆåŒºåŸŸå†…
    let isValid = this.isPointInPolygon(x, y, boundaryVertices);
    if (holeVertices && isValid) {
      isValid = !this.isPointInPolygon(x, y, holeVertices);
    }
    
    if (isValid) {
      // æ·»åŠ åˆ°ç½‘æ ¼é¡¶ç‚¹åˆ—è¡¨
      meshVertices.push({
        index: vertexIndex,
        x, y,
        gridX: i, gridY: j,
        u: uvU, v: uvV,
        isHoleBoundary: false
      });
    }
  }
}
```

#### 1.2 å­”æ´è¾¹ç•Œç‚¹é›†æˆ â˜…
```javascript
// å°†å­”æ´è¾¹ç•Œç‚¹é›†æˆåˆ°ä¸»é¢ç½‘æ ¼
if (holeVertices && holeVertices.length > 0) {
  holeVertices.forEach((vIdx, i) => {
    const vertex = this.vertices[vIdx - 1];
    
    // è®¡ç®—UVåæ ‡
    const u = (vertex.x + width / 2) / width;
    const v_coord = (vertex.y + height / 2) / height;
    const uvU = isFront ? u : (1.0 - u);  // èƒŒé¢é•œåƒ
    const uvV = v_coord;
    
    // æ·»åŠ åˆ°ä¸»é¢ç½‘æ ¼
    meshVertices.push({
      index: vIdx,
      x: vertex.x,
      y: vertex.y,
      gridX: null,      // å­”æ´è¾¹ç•Œç‚¹ä¸å±äºè§„åˆ™ç½‘æ ¼
      gridY: null,
      u: uvU,
      v: uvV,
      isHoleBoundary: true  // é‡è¦æ ‡è®°
    });
  });
}
```

### ç¬¬äºŒæ­¥ï¼šä¸»é¢ä¸‰è§’å‰–åˆ†

#### 2.1 è§„åˆ™ç½‘æ ¼ä¸‰è§’å‰–åˆ†
ä½¿ç”¨å››è¾¹å½¢å¯¹è§’çº¿åˆ†å‰²ç­–ç•¥ï¼Œç”Ÿæˆé«˜è´¨é‡ä¸‰è§’å½¢ï¼š

```javascript
// ä¼˜åŒ–çš„å››è¾¹å½¢åˆ†å‰²ç®—æ³•
const diag1 = Math.sqrt((v1.x - v4.x) ** 2 + (v1.y - v4.y) ** 2);
const diag2 = Math.sqrt((v2.x - v3.x) ** 2 + (v2.y - v3.y) ** 2);

if (diag1 <= diag2) {
  // ä½¿ç”¨v1-v4å¯¹è§’çº¿åˆ†å‰²
  this.addFace(v1.index, v2.index, v4.index, uv1, uv2, uv4);
  this.addFace(v1.index, v4.index, v3.index, uv1, uv4, uv3);
} else {
  // ä½¿ç”¨v2-v3å¯¹è§’çº¿åˆ†å‰²
  this.addFace(v1.index, v2.index, v3.index, uv1, uv2, uv3);
  this.addFace(v2.index, v4.index, v3.index, uv2, uv4, uv3);
}
```

### ç¬¬ä¸‰æ­¥ï¼šåœ†å¼§è¾¹ç•Œè¿æ¥ â˜…

#### 3.1 ç®—æ³•æ ¸å¿ƒæ€æƒ³
- **å­”æ´è¾¹ç•Œç‚¹å·²ç»åœ¨ä¸»é¢ç½‘æ ¼ä¸­**ï¼Œä¸éœ€è¦"è·¨è¶Šå¼"è¿æ¥
- **ä½¿ç”¨æ‰‡å½¢ä¸‰è§’å½¢è¿æ¥**ï¼Œä¿æŒåœ†å¼§çš„å¹³æ»‘æ€§
- **è´¨é‡æ§åˆ¶**ï¼Œé¿å…ç»†é•¿ä¸‰è§’å½¢

#### 3.2 è¿æ¥ç®—æ³•å®ç°
```javascript
generateCircularBoundaryConnections(meshVertices, meshUVs, boundaryVertices, regularMeshVertices, isFront, isHole) {
  boundaryVertices.forEach((boundaryVertex, boundaryIndex) => {
    // 1. æ‰¾åˆ°æœ€è¿‘çš„è§„åˆ™ç½‘æ ¼ç‚¹
    const nearbyVertices = regularMeshVertices
      .filter(mv => !mv.isHoleBoundary)  // æ’é™¤å…¶ä»–è¾¹ç•Œç‚¹
      .map(mv => ({
        ...mv,
        distance: Math.sqrt((mv.x - boundaryVertex.x) ** 2 + (mv.y - boundaryVertex.y) ** 2)
      }))
      .sort((a, b) => a.distance - b.distance)
      .slice(0, isHole ? 4 : 3);  // å­”æ´ä½¿ç”¨æ›´å¤šè¿æ¥ç‚¹
    
    // 2. ä¸ºç›¸é‚»ç½‘æ ¼ç‚¹åˆ›å»ºæ‰‡å½¢ä¸‰è§’å½¢
    for (let j = 0; j < nearbyVertices.length - 1; j++) {
      const mv1 = nearbyVertices[j];
      const mv2 = nearbyVertices[j + 1];
      
      // 3. ä¸‰è§’å½¢è´¨é‡æ£€æŸ¥
      const aspectRatio = this.calculateAspectRatio(boundaryVertex, mv1, mv2);
      if (aspectRatio < 8.0) {  // å®½é«˜æ¯”é˜ˆå€¼
        // 4. æ³•çº¿æ–¹å‘å¤„ç†
        if (isHole) {
          // å­”æ´ï¼šé€†æ—¶é’ˆé¡¶ç‚¹é¡ºåº
          this.addFaceWithNormalCheck(boundaryVertex.index, mv2.index, mv1.index, ...);
        } else {
          // å¤–è¾¹ç•Œï¼šé¡ºæ—¶é’ˆé¡¶ç‚¹é¡ºåº
          this.addFaceWithNormalCheck(boundaryVertex.index, mv1.index, mv2.index, ...);
        }
      }
    }
  });
}
```

#### 3.3 æ³•çº¿æ–¹å‘æ§åˆ¶
```javascript
addFaceWithNormalCheck(v1, v2, v3, uv1, uv2, uv3, isFront) {
  if (this.isNormalCorrect(v1, v2, v3, isFront)) {
    this.addFace(v1, v2, v3, uv1, uv2, uv3);
  } else {
    // æ³•çº¿æ–¹å‘é”™è¯¯ï¼Œç¿»è½¬é¡¶ç‚¹é¡ºåº
    this.addFace(v1, v3, v2, uv1, uv3, uv2);
  }
}
```

## å‚æ•°é…ç½®

### 1. ç½‘æ ¼å¯†åº¦è®¾ç½®
```javascript
const retopologyDensity = {
  'low': { density: 20 },
  'medium': { density: 40 },
  'high': { density: 60 },
  'ultra': { density: 80 }
};
```

### 2. è´¨é‡æ§åˆ¶å‚æ•°
```javascript
const meshQuality = {
  enableBoundaryConnection: true,    // æ˜¯å¦å¯ç”¨è¾¹ç•Œè¿æ¥
  maxBoundaryConnections: 3,         // æœ€å¤§è¾¹ç•Œè¿æ¥æ•°
  enableRetopology: true,            // æ˜¯å¦å¯ç”¨é‡æ‹“æ‰‘ä¼˜åŒ–
  retopologyDensity: 'high'          // é‡æ‹“æ‰‘å¯†åº¦
};
```

### 3. ä¸‰è§’å½¢è´¨é‡é˜ˆå€¼
```javascript
const qualityThresholds = {
  aspectRatio: 8.0,          // å®½é«˜æ¯”é˜ˆå€¼
  holeConnections: 4,        // å­”æ´è¾¹ç•Œè¿æ¥ç‚¹æ•°
  outerConnections: 3        // å¤–è¾¹ç•Œè¿æ¥ç‚¹æ•°
};
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºæœ¬ä½¿ç”¨
```javascript
const exporter = new BadgeOBJExporter();

// è®¾ç½®ç½‘æ ¼è´¨é‡
exporter.setMeshQuality(
  true,    // enableBoundaryConnection
  3,       // maxBoundaryConnections
  true,    // enableRetopology
  'high'   // retopologyDensity
);

// å¯¼å‡ºæ¨¡å‹
const objContent = exporter.generateBadgeOBJ(
  badgeSettings,
  holeSettings,
  imageSettings,
  textSettings,
  exportSettings
);
```

### 2. é«˜çº§é…ç½®
```javascript
const exportSettings = {
  doubleSided: true,
  thickness: 2.0,
  meshDensity: { density: 60 },
  meshQuality: {
    enableBoundaryConnection: true,
    maxBoundaryConnections: 4,
    enableRetopology: true,
    retopologyDensity: 'ultra'
  }
};
```

## ç®—æ³•ä¼˜åŠ¿

### 1. æŠ€æœ¯ä¼˜åŠ¿
- **æ°´å¯†æ€§ä¿è¯**ï¼šæ‰€æœ‰è¾¹ç•Œéƒ½æ­£ç¡®è¿æ¥ï¼Œæ— ç ´æ´
- **åœ†å¼§ä¿çœŸ**ï¼šå­”æ´å’Œåœ†è§’ä¿æŒåŸå§‹çš„åœ†å¼§ç‰¹å¾
- **æ³•çº¿æ­£ç¡®**ï¼šè‡ªåŠ¨æ³•çº¿æ£€æŸ¥ï¼Œç¡®ä¿å…‰ç…§æ­£å¸¸
- **è´¨é‡å¯æ§**ï¼šä¸‰è§’å½¢è´¨é‡æ£€æŸ¥ï¼Œé¿å…é€€åŒ–å‡ ä½•

### 2. æ€§èƒ½ä¼˜åŠ¿
- **ç®—æ³•ç®€æ´**ï¼šå¤ç”¨åœ†è§’å¤„ç†é€»è¾‘ï¼Œä»£ç é‡å°‘
- **è®¡ç®—é«˜æ•ˆ**ï¼šé¿å…å¤æ‚çš„çº¦æŸä¸‰è§’å‰–åˆ†
- **å†…å­˜å‹å¥½**ï¼šè¾¹ç•Œç‚¹ç›´æ¥é›†æˆï¼Œæ— é¢å¤–å­˜å‚¨

### 3. ç»´æŠ¤ä¼˜åŠ¿
- **é€»è¾‘ç»Ÿä¸€**ï¼šå­”æ´å’Œåœ†è§’ä½¿ç”¨ç›¸åŒç®—æ³•
- **å‚æ•°å¯è°ƒ**ï¼šè´¨é‡é˜ˆå€¼å¯æ ¹æ®éœ€æ±‚è°ƒæ•´
- **æ˜“äºæ‰©å±•**ï¼šç®—æ³•æ¡†æ¶æ”¯æŒæ–°çš„è¾¹ç•Œç±»å‹

## è°ƒè¯•ä¸ä¼˜åŒ–

### 1. å¸¸è§é—®é¢˜
- **ç ´æ´ä¾ç„¶å­˜åœ¨**ï¼šæ£€æŸ¥ç½‘æ ¼å¯†åº¦æ˜¯å¦è¶³å¤Ÿ
- **å­”æ´è¢«å¡«å……**ï¼šæ£€æŸ¥è´¨é‡é˜ˆå€¼è®¾ç½®
- **æ³•çº¿æ–¹å‘é”™è¯¯**ï¼šæ£€æŸ¥é¡¶ç‚¹é¡ºåº

### 2. è°ƒè¯•æ–¹æ³•
```javascript
// å¯ç”¨è¯¦ç»†æ—¥å¿—
console.log(`å­”æ´è¾¹ç•Œç‚¹é›†æˆå®Œæˆï¼Œä¸»é¢ç½‘æ ¼æ€»é¡¶ç‚¹æ•°: ${meshVertices.filter(v => v !== null).length}`);
console.log(`å­”æ´åœ†å¼§è¾¹ç•Œè¿æ¥ï¼šç”Ÿæˆäº†${triangleCount}ä¸ªè¿æ¥ä¸‰è§’å½¢`);
```

### 3. æ€§èƒ½ä¼˜åŒ–å»ºè®®
- æ ¹æ®å·¥ç‰Œå°ºå¯¸è°ƒæ•´ç½‘æ ¼å¯†åº¦
- å¯¹äºç®€å•å½¢çŠ¶ï¼Œå¯é™ä½è´¨é‡é˜ˆå€¼
- æ‰¹é‡å¯¼å‡ºæ—¶è€ƒè™‘ç¼“å­˜ç½‘æ ¼æ¨¡æ¿

## ç‰ˆæœ¬å†å²

- **v1.0**ï¼šåŸºç¡€é‡æ‹“æ‰‘ç®—æ³•
- **v2.0**ï¼šæ·»åŠ å­”æ´è¾¹ç•Œè¿æ¥
- **v3.0**ï¼šç»Ÿä¸€åœ†å¼§è¾¹ç•Œç®—æ³• â˜…
- **v3.1**ï¼šä¼˜åŒ–ä¸‰è§’å½¢è´¨é‡æ§åˆ¶

## ç›¸å…³æ–‡ä»¶

- `src/utils/objExporter.js` - ä¸»è¦å®ç°æ–‡ä»¶
- `src/utils/README_RETOPOLOGY.md` - æœ¬æ–‡æ¡£
- `src/constants/unitConfig.js` - é…ç½®å‚æ•°

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°ï¼š2024å¹´12æœˆ* 